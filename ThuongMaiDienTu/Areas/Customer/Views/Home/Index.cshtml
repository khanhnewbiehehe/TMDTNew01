@model ThuongMaiDienTu.ViewModels.ProductCardVM
<link rel="stylesheet" href="~/css/featured-product.css" />
<div class="container">
    <div class="carousel_image">
        <div id="carouselExampleIndicators" class="carousel slide">
            <div class="carousel-indicators">
                <button type="button" data-bs-target="#carouselExampleIndicators" data-bs-slide-to="0" class="active" aria-current="true" aria-label="Slide 1"></button>
                <button type="button" data-bs-target="#carouselExampleIndicators" data-bs-slide-to="1" aria-label="Slide 2"></button>
                <button type="button" data-bs-target="#carouselExampleIndicators" data-bs-slide-to="2" aria-label="Slide 3"></button>
                <button type="button" data-bs-target="#carouselExampleIndicators" data-bs-slide-to="3" aria-label="Slide 4"></button>
                <button type="button" data-bs-target="#carouselExampleIndicators" data-bs-slide-to="4" aria-label="Slide 5"></button>
                <button type="button" data-bs-target="#carouselExampleIndicators" data-bs-slide-to="5" aria-label="Slide 6"></button>
            </div>
            <div class="carousel-inner">
                <div class="carousel-item active" style="max-height: 500px; overflow: hidden;">
                    <img src="./assets/images/carousel1.jpg" class="d-block w-100" alt="...">
                </div>
                <div class="carousel-item" style="max-height: 500px; overflow: hidden;">
                    <img src="./assets/images/carousel2.jpg" class="d-block w-100" alt="...">
                </div>
                <div class="carousel-item" style="max-height: 500px; overflow: hidden;">
                    <img src="./assets/images/carousel3.jpg" class="d-block w-100" alt="...">
                </div>
                <div class="carousel-item" style="max-height: 500px; overflow: hidden;">
                    <img src="./assets/images/carousel4.jpg" class="d-block w-100" alt="...">
                </div>
                <div class="carousel-item" style="max-height: 500px; overflow: hidden;">
                    <img src="./assets/images/carousel5.jpg" class="d-block w-100" alt="...">
                </div>
                <div class="carousel-item" style="max-height: 500px; overflow: hidden;">
                    <img src="./assets/images/carousel6.jpg" class="d-block w-100" alt="...">
                </div>
            </div>
            <button class="carousel-control-prev" type="button" data-bs-target="#carouselExampleIndicators" data-bs-slide="prev">
                <span class="carousel-control-prev-icon" aria-hidden="true"></span>
                <span class="visually-hidden">Previous</span>
            </button>
            <button class="carousel-control-next" type="button" data-bs-target="#carouselExampleIndicators" data-bs-slide="next">
                <span class="carousel-control-next-icon" aria-hidden="true"></span>
                <span class="visually-hidden">Next</span>
            </button>
        </div>

    </div>
    <div class="trend_product">
        <h3 class="my_smalltitle" id="trending-hearder" style="cursor: pointer">Trending</h3>
        <div id="list-product" class="list_product owl-carousel carousel-1">
        </div>
    </div>
    <h3 class="text-center my_largetitle" id="categories-header" style="cursor: pointer;">Categories</h3>
    <div class="list_categories ">
        <div id="list-categories" class="owl-carousel carousel-2">
        </div>
    </div>
    <h3 class="my_smalltitle" id="feature-product-header" style="cursor:pointer">Feature product</h3>
    <div class="row">
        @if (Model != null)
        {
            <div class="col-md-3 d-none d-md-block">
                <div class="card my_card">
                    <div class="my_countdown d-flex justify-content-center align-items-center">
                        <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 512 512">
                            <path d="M464 256A208 208 0 1 1 48 256a208 208 0 1 1 416 0zM0 256a256 256 0 1 0 512 0A256 256 0 1 0 0 256zM232 120l0 136c0 8 4 15.5 10.7 20l96 64c11 7.4 25.9 4.4 33.3-6.7s4.4-25.9-6.7-33.3L280 243.2 280 120c0-13.3-10.7-24-24-24s-24 10.7-24 24z" />
                        </svg>
                        <span id="featured-countdown" data-end="@Model.End.ToString("yyyy-MM-ddTHH:mm:ss")"></span>
                    </div>
                    <div class="my_cardimage d-flex justify-content-center align-items-center">
                        <div class="my_overlay d-flex justify-content-center align-items-center">
                            <button onclick="CreateFavourite(@Model.Id)" class="btn my_overlaybtn d-flex justify-content-center align-items-center">
                                <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 512 512">
                                    <path d="M225.8 468.2l-2.5-2.3L48.1 303.2C17.4 274.7 0 234.7 0 192.8l0-3.3c0-70.4 50-130.8 119.2-144C158.6 37.9 198.9 47 231 69.6c9 6.4 17.4 13.8 25 22.3c4.2-4.8 8.7-9.2 13.5-13.3c3.7-3.2 7.5-6.2 11.5-9c0 0 0 0 0 0C313.1 47 353.4 37.9 392.8 45.4C462 58.6 512 119.1 512 189.5l0 3.3c0 41.9-17.4 81.9-48.1 110.4L288.7 465.9l-2.5 2.3c-8.2 7.6-19 11.9-30.2 11.9s-22-4.2-30.2-11.9zM239.1 145c-.4-.3-.7-.7-1-1.1l-17.8-20-.1-.1s0 0 0 0c-23.1-25.9-58-37.7-92-31.2C81.6 101.5 48 142.1 48 189.5l0 3.3c0 28.5 11.9 55.8 32.8 75.2L256 430.7 431.2 268c20.9-19.4 32.8-46.7 32.8-75.2l0-3.3c0-47.3-33.6-88-80.1-96.9c-34-6.5-69 5.4-92 31.2c0 0 0 0-.1 .1s0 0-.1 .1l-17.8 20c-.3 .4-.7 .7-1 1.1c-4.5 4.5-10.6 7-16.9 7s-12.4-2.5-16.9-7z" />
                                </svg>
                            </button>
                            <a href="/Product/Details/@Model.Id" class="btn my_overlaybtn d-flex justify-content-center align-items-center">
                                <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 576 512">
                                    <path d="M288 80c-65.2 0-118.8 29.6-159.9 67.7C89.6 183.5 63 226 49.4 256c13.6 30 40.2 72.5 78.6 108.3C169.2 402.4 222.8 432 288 432s118.8-29.6 159.9-67.7C486.4 328.5 513 286 526.6 256c-13.6-30-40.2-72.5-78.6-108.3C406.8 109.6 353.2 80 288 80zM95.4 112.6C142.5 68.8 207.2 32 288 32s145.5 36.8 192.6 80.6c46.8 43.5 78.1 95.4 93 131.1c3.3 7.9 3.3 16.7 0 24.6c-14.9 35.7-46.2 87.7-93 131.1C433.5 443.2 368.8 480 288 480s-145.5-36.8-192.6-80.6C48.6 356 17.3 304 2.5 268.3c-3.3-7.9-3.3-16.7 0-24.6C17.3 208 48.6 156 95.4 112.6zM288 336c44.2 0 80-35.8 80-80s-35.8-80-80-80c-.7 0-1.3 0-2 0c1.3 5.1 2 10.5 2 16c0 35.3-28.7 64-64 64c-5.5 0-10.9-.7-16-2c0 .7 0 1.3 0 2c0 44.2 35.8 80 80 80zm0-208a128 128 0 1 1 0 256 128 128 0 1 1 0-256z" />
                                </svg>
                            </a>
                            <button class="btn my_overlaybtn d-flex justify-content-center align-items-center">
                                <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 576 512">
                                    <path d="M0 24C0 10.7 10.7 0 24 0L69.5 0c22 0 41.5 12.8 50.6 32l411 0c26.3 0 45.5 25 38.6 50.4l-41 152.3c-8.5 31.4-37 53.3-69.5 53.3l-288.5 0 5.4 28.5c2.2 11.3 12.1 19.5 23.6 19.5L488 336c13.3 0 24 10.7 24 24s-10.7 24-24 24l-288.3 0c-34.6 0-64.3-24.6-70.7-58.5L77.4 54.5c-.7-3.8-4-6.5-7.9-6.5L24 48C10.7 48 0 37.3 0 24zM128 464a48 48 0 1 1 96 0 48 48 0 1 1 -96 0zm336-48a48 48 0 1 1 0 96 48 48 0 1 1 0-96z" />
                                </svg>
                            </button>
                        </div>
                        <img src="@Model.ImageUrl" alt="@Model.Name">
                    </div>                    <div class="card-body my_card_body">
                        <h5 class="card-title my_card_title">@Model.Name</h5>
                        <!-- Rating and reviews section hidden as requested -->
                        <!-- <strong class="mt-1">@Model.Registration đã bán</strong> -->
                        <p class="my_pricestyle mt-2">@(Model.Min.ToString("#,###") + "₫") - @(Model.Max.ToString("#,###") + "₫")</p>
                        
                        <!-- Product description section -->
                        <div class="product-description d-none d-md-block">
                            <p class="description-text">@Model.Description</p>
                        </div>
                        
                        <div class="d-none d-md-block">
                            <a onclick="CreateFavourite(@Model.Id)" href="javascript:void(0)" class="btn btn-warning w-100 mb-2">
                                <svg xmlns="http://www.w3.org/2000/svg" width="16px" fill="white" viewBox="0 0 512 512">
                                    <path d="M225.8 468.2l-2.5-2.3L48.1 303.2C17.4 274.7 0 234.7 0 192.8l0-3.3c0-70.4 50-130.8 119.2-144C158.6 37.9 198.9 47 231 69.6c9 6.4 17.4 13.8 25 22.3c4.2-4.8 8.7-9.2 13.5-13.3c3.7-3.2 7.5-6.2 11.5-9c0 0 0 0 0 0C313.1 47 353.4 37.9 392.8 45.4C462 58.6 512 119.1 512 189.5l0 3.3c0 41.9-17.4 81.9-48.1 110.4L288.7 465.9l-2.5 2.3c-8.2 7.6-19 11.9-30.2 11.9s-22-4.2-30.2-11.9zM239.1 145c-.4-.3-.7-.7-1-1.1l-17.8-20-.1-.1s0 0 0 0c-23.1-25.9-58-37.7-92-31.2C81.6 101.5 48 142.1 48 189.5l0 3.3c0 28.5 11.9 55.8 32.8 75.2L256 430.7 431.2 268c20.9-19.4 32.8-46.7 32.8-75.2l0-3.3c0-47.3-33.6-88-80.1-96.9c-34-6.5-69 5.4-92 31.2c0 0 0 0-.1 .1s0 0-.1 .1l-17.8 20c-.3 .4-.7 .7-1 1.1c-4.5 4.5-10.6 7-16.9 7s-12.4-2.5-16.9-7z" />
                                </svg>
                                <span class="text-light">Favorite</span>
                            </a>
                            <a href="/Product/Details/@Model.Id" class="btn btn-primary w-100 mb-2">
                                <svg xmlns="http://www.w3.org/2000/svg" width="16px" fill="white" viewBox="0 0 576 512">
                                    <path d="M288 80c-65.2 0-118.8 29.6-159.9 67.7C89.6 183.5 63 226 49.4 256c13.6 30 40.2 72.5 78.6 108.3C169.2 402.4 222.8 432 288 432s118.8-29.6 159.9-67.7C486.4 328.5 513 286 526.6 256c-13.6-30-40.2-72.5-78.6-108.3C406.8 109.6 353.2 80 288 80zM95.4 112.6C142.5 68.8 207.2 32 288 32s145.5 36.8 192.6 80.6c46.8 43.5 78.1 95.4 93 131.1c3.3 7.9 3.3 16.7 0 24.6c-14.9 35.7-46.2 87.7-93 131.1C433.5 443.2 368.8 480 288 480s-145.5-36.8-192.6-80.6C48.6 356 17.3 304 2.5 268.3c-3.3-7.9-3.3-16.7 0-24.6C17.3 208 48.6 156 95.4 112.6zM288 336c44.2 0 80-35.8 80-80s-35.8-80-80-80c-.7 0-1.3 0-2 0c1.3 5.1 2 10.5 2 16c0 35.3-28.7 64-64 64c-5.5 0-10.9-.7-16-2c0 .7 0 1.3 0 2c0 44.2 35.8 80 80 80zm0-208a128 128 0 1 1 0 256 128 128 0 1 1 0-256z" />
                                </svg>
                                Details
                            </a>
                        </div>
                        <div class="progress my_progress">
                            <div class="progress-bar progress-bar-striped" role="progressbar"
                                 style="width: @(Model.Registration * 100 / Math.Max(1, Model.Quantity))%"
                                 aria-valuenow="@(Model.Registration * 100 / Math.Max(1, Model.Quantity))"
                                 aria-valuemin="0"
                                 aria-valuemax="100"></div>
                        </div>
                    </div>
                </div>
            </div>
        }
        <div class="col-md-9 col-12">
            <div class="list_product d-flex flex-wrap justify-content-center justify-content-md-end">
            </div>
        </div>
    </div>
    
</div>
<h3 class="my_smalltitle" id="for-you-header" style="cursor:pointer">For you</h3>
<div id="list-product" class="list_product owl-carousel carousel-1">
</div>
@section Scripts {
    <script src="~/LoadData/LoadCategory.js"></script>
    <script src="~/LoadData/LoadProduct.js"></script>
    <script>
        document.getElementById('categories-header').addEventListener('click', function() {
            window.location.href = '/Customer/Search';
        });
        document.getElementById('trending-hearder').addEventListener('click', function() {
            window.location.href = '/Customer/Search';
        });
        document.getElementById('feature-product-header').addEventListener('click', function() {
            window.location.href = '/Customer/Search';
        });
        document.getElementById('for-you-header').addEventListener('click', function() {
            window.location.href = '/Customer/Search';
        });
    </script>
    <script>
        // Update countdown for featured product
        $(document).ready(function() {
            function updateCountdown() {
                const endTimeElement = $('#featured-countdown');
                if (endTimeElement.length > 0) {
                    const endTime = new Date(endTimeElement.data('end')).getTime();
                    const now = new Date().getTime();
                    const distance = endTime - now;

                    if (distance <= 0) {
                        endTimeElement.text("Đã kết thúc");
                    } else {
                        const days = Math.floor(distance / (1000 * 60 * 60 * 24));
                        const hours = Math.floor((distance % (1000 * 60 * 60 * 24)) / (1000 * 60 * 60));
                        const minutes = Math.floor((distance % (1000 * 60 * 60)) / (1000 * 60));
                        const seconds = Math.floor((distance % (1000 * 60)) / 1000);

                        endTimeElement.text(`${days}d ${hours}h ${minutes}m ${seconds}s`);
                    }
                }
            }

            // Update countdown immediately and then every second
            updateCountdown();
            setInterval(updateCountdown, 1000);
        });

        // Function to create favorite - reused from LoadProduct.js
        function CreateFavourite(id) {
            $.ajax({
                url: `/Guest/Favourite/${id}`,
                type: 'POST',
                success: function (data) {
                    if (data.redirect) {
                        Swal.fire({
                            title: 'Yêu cầu đăng nhập',
                            text: data.message || 'Vui lòng đăng nhập trước khi thêm vào yêu thích.',
                            icon: 'warning',
                            confirmButtonText: 'Đăng nhập'
                        }).then(() => {
                            window.location.href = data.redirect;
                        });
                    } else if (data.success && data.forwardTo) {
                        $.ajax({
                            url: data.forwardTo,
                            type: 'POST',
                            success: function (res) {
                                if (res.success) {
                                    Swal.fire({
                                        title: 'Thành công!',
                                        text: 'Sản phẩm đã được thêm vào yêu thích.',
                                        icon: 'success',
                                        confirmButtonText: 'OK'
                                    });
                                } else {
                                    Swal.fire({
                                        title: 'Thất bại!',
                                        text: res.message || 'Không thể thêm vào yêu thích.',
                                        icon: 'error',
                                        confirmButtonText: 'OK'
                                    });
                                }
                            },
                            error: function () {
                                Swal.fire({
                                    title: 'Lỗi!',
                                    text: 'Đã xảy ra lỗi khi thêm vào yêu thích.',
                                    icon: 'error',
                                    confirmButtonText: 'OK'
                                });
                            }
                        });
                    } else {
                        Swal.fire({
                            title: 'Không thể thực hiện',
                            text: data.message || 'Hành động không hợp lệ.',
                            icon: 'error',
                            confirmButtonText: 'OK'
                        });
                    }
                },
                error: function () {
                    Swal.fire({
                        title: 'Lỗi!',
                        text: 'Đã xảy ra lỗi khi gửi yêu cầu.',
                        icon: 'error',
                        confirmButtonText: 'OK'
                    });
                }
            });
        }
    </script>
}